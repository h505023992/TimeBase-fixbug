Args in experiment:
Namespace(is_training=1, model_id='weather_336_192', model='iTransformer', data='custom', root_path='./dataset/', data_path='weather.csv', features='M', target='OT', freq='h', checkpoints='./checkpoints/', seq_len=336, label_len=48, pred_len=192, enc_in=21, dec_in=21, c_out=21, d_model=128, n_heads=8, e_layers=3, d_layers=1, d_ff=128, moving_avg=25, factor=1, distil=True, dropout=0.1, embed='timeF', activation='gelu', output_attention=False, do_predict=False, num_workers=10, itr=1, train_epochs=10, batch_size=64, patience=3, learning_rate=0.0001, des='Exp', loss='MSE', lradj='type1', use_amp=False, use_gpu=True, gpu=2, use_multi_gpu=False, devices='0,1,2,3', exp_name='MTSF', channel_independence=False, inverse=False, class_strategy='projection', target_root_path='./data/electricity/', target_data_path='electricity.csv', efficient_training=False, use_norm=True, partial_start_index=0)
Use GPU: cuda:2
[INFO] Register count_linear() for <class 'torch.nn.modules.linear.Linear'>.
[INFO] Register zero_ops() for <class 'torch.nn.modules.dropout.Dropout'>.
[INFO] Register count_convNd() for <class 'torch.nn.modules.conv.Conv1d'>.
[INFO] Register count_normalization() for <class 'torch.nn.modules.normalization.LayerNorm'>.
MACs: 9884160.0
Params: 366912.0
9.88M MACs
>>>>>>>start training : weather_336_192_iTransformer_custom_M_ft336_sl48_ll192_pl128_dm8_nh3_el1_dl128_df1_fctimeF_ebTrue_dtExp_projection_0>>>>>>>>>>>>>>>>>>>>>>>>>>
train 36360
val 5079
test 10348
	iters: 100, epoch: 1 | loss: 0.5272651
	speed: 0.1052s/iter; left time: 587.1345s
	iters: 200, epoch: 1 | loss: 0.4378491
	speed: 0.0825s/iter; left time: 452.3194s
	iters: 300, epoch: 1 | loss: 0.4749406
	speed: 0.0823s/iter; left time: 442.8254s
	iters: 400, epoch: 1 | loss: 0.6802696
	speed: 0.0838s/iter; left time: 442.5330s
	iters: 500, epoch: 1 | loss: 0.4525148
	speed: 0.0795s/iter; left time: 411.9614s
Max Memory (MB): 178.2080078125
Epoch: 1 cost time: 49.03184628486633
Epoch: 1, Steps: 568 | Train Loss: 0.5659406 Vali Loss: 0.5018663 Test Loss: 0.2180200
Validation loss decreased (inf --> 0.501866).  Saving model ...
Updating learning rate to 0.0001
	iters: 100, epoch: 2 | loss: 0.6597470
	speed: 1.4665s/iter; left time: 7351.3956s
	iters: 200, epoch: 2 | loss: 0.5718803
	speed: 0.0687s/iter; left time: 337.4442s
	iters: 300, epoch: 2 | loss: 0.3429655
	speed: 0.0649s/iter; left time: 312.5217s
	iters: 400, epoch: 2 | loss: 0.4564586
	speed: 0.0651s/iter; left time: 306.7770s
	iters: 500, epoch: 2 | loss: 0.3932554
	speed: 0.0664s/iter; left time: 306.2027s
Max Memory (MB): 178.2080078125
Epoch: 2 cost time: 38.971858501434326
Epoch: 2, Steps: 568 | Train Loss: 0.4935577 Vali Loss: 0.4732802 Test Loss: 0.2061771
Validation loss decreased (0.501866 --> 0.473280).  Saving model ...
Updating learning rate to 5e-05
	iters: 100, epoch: 3 | loss: 0.4111510
	speed: 1.3644s/iter; left time: 6064.9038s
	iters: 200, epoch: 3 | loss: 0.3830538
	speed: 0.0818s/iter; left time: 355.6240s
	iters: 300, epoch: 3 | loss: 0.4205816
	speed: 0.0860s/iter; left time: 365.1441s
	iters: 400, epoch: 3 | loss: 0.8946849
	speed: 0.0888s/iter; left time: 367.9608s
	iters: 500, epoch: 3 | loss: 0.4003461
	speed: 0.0834s/iter; left time: 337.4166s
Max Memory (MB): 178.2080078125
Epoch: 3 cost time: 48.37321400642395
Epoch: 3, Steps: 568 | Train Loss: 0.4787960 Vali Loss: 0.4649842 Test Loss: 0.2043737
Validation loss decreased (0.473280 --> 0.464984).  Saving model ...
Updating learning rate to 2.5e-05
	iters: 100, epoch: 4 | loss: 0.5766978
	speed: 1.4982s/iter; left time: 5808.5275s
	iters: 200, epoch: 4 | loss: 0.8712952
	speed: 0.0757s/iter; left time: 285.9507s
	iters: 300, epoch: 4 | loss: 0.4694806
	speed: 0.0751s/iter; left time: 276.2860s
	iters: 400, epoch: 4 | loss: 0.4543498
	speed: 0.0750s/iter; left time: 268.4476s
	iters: 500, epoch: 4 | loss: 0.6888798
	speed: 0.0766s/iter; left time: 266.4997s
Max Memory (MB): 178.2080078125
Epoch: 4 cost time: 45.969610929489136
Epoch: 4, Steps: 568 | Train Loss: 0.4729122 Vali Loss: 0.4631161 Test Loss: 0.2039700
Validation loss decreased (0.464984 --> 0.463116).  Saving model ...
Updating learning rate to 1.25e-05
	iters: 100, epoch: 5 | loss: 0.3426137
	speed: 1.4741s/iter; left time: 4877.8572s
	iters: 200, epoch: 5 | loss: 0.4002138
	speed: 0.0695s/iter; left time: 222.9247s
	iters: 300, epoch: 5 | loss: 0.7885484
	speed: 0.0752s/iter; left time: 233.6707s
	iters: 400, epoch: 5 | loss: 0.4931724
	speed: 0.0808s/iter; left time: 243.2050s
	iters: 500, epoch: 5 | loss: 0.4395169
	speed: 0.0803s/iter; left time: 233.6615s
Max Memory (MB): 178.2080078125
Epoch: 5 cost time: 44.476046085357666
Epoch: 5, Steps: 568 | Train Loss: 0.4702606 Vali Loss: 0.4624265 Test Loss: 0.2032818
Validation loss decreased (0.463116 --> 0.462427).  Saving model ...
Updating learning rate to 6.25e-06
	iters: 100, epoch: 6 | loss: 0.3899111
	speed: 1.5099s/iter; left time: 4138.7486s
	iters: 200, epoch: 6 | loss: 0.3243888
	speed: 0.0903s/iter; left time: 238.4151s
	iters: 300, epoch: 6 | loss: 0.4235199
	speed: 0.0758s/iter; left time: 192.6528s
	iters: 400, epoch: 6 | loss: 0.4661283
	speed: 0.0728s/iter; left time: 177.6554s
	iters: 500, epoch: 6 | loss: 0.3952530
	speed: 0.0759s/iter; left time: 177.7534s
Max Memory (MB): 178.2080078125
Epoch: 6 cost time: 47.28069710731506
Epoch: 6, Steps: 568 | Train Loss: 0.4685649 Vali Loss: 0.4635761 Test Loss: 0.2035259
EarlyStopping counter: 1 out of 3
Updating learning rate to 3.125e-06
	iters: 100, epoch: 7 | loss: 0.6379619
	speed: 1.4482s/iter; left time: 3147.0465s
	iters: 200, epoch: 7 | loss: 0.3537387
	speed: 0.0758s/iter; left time: 157.0715s
	iters: 300, epoch: 7 | loss: 0.6215174
	speed: 0.0803s/iter; left time: 158.3827s
	iters: 400, epoch: 7 | loss: 0.4084736
	speed: 0.0804s/iter; left time: 150.5211s
	iters: 500, epoch: 7 | loss: 0.4209992
	speed: 0.0712s/iter; left time: 126.2975s
Max Memory (MB): 178.2080078125
Epoch: 7 cost time: 44.734086990356445
Epoch: 7, Steps: 568 | Train Loss: 0.4681618 Vali Loss: 0.4623764 Test Loss: 0.2032993
Validation loss decreased (0.462427 --> 0.462376).  Saving model ...
Updating learning rate to 1.5625e-06
	iters: 100, epoch: 8 | loss: 0.8315192
	speed: 1.3971s/iter; left time: 2242.3298s
	iters: 200, epoch: 8 | loss: 0.4562980
	speed: 0.0704s/iter; left time: 105.8925s
	iters: 300, epoch: 8 | loss: 0.3705265
	speed: 0.0692s/iter; left time: 97.1865s
	iters: 400, epoch: 8 | loss: 0.3868804
	speed: 0.0757s/iter; left time: 98.7850s
	iters: 500, epoch: 8 | loss: 1.0728015
	speed: 0.0790s/iter; left time: 95.1670s
Max Memory (MB): 178.2080078125
Epoch: 8 cost time: 43.392688512802124
Epoch: 8, Steps: 568 | Train Loss: 0.4678408 Vali Loss: 0.4629475 Test Loss: 0.2033798
EarlyStopping counter: 1 out of 3
Updating learning rate to 7.8125e-07
	iters: 100, epoch: 9 | loss: 0.4077752
	speed: 1.6545s/iter; left time: 1715.7302s
	iters: 200, epoch: 9 | loss: 0.4721851
	speed: 0.0720s/iter; left time: 67.4527s
	iters: 300, epoch: 9 | loss: 0.5250149
	speed: 0.0705s/iter; left time: 58.9776s
	iters: 400, epoch: 9 | loss: 0.8040362
	speed: 0.0739s/iter; left time: 54.4973s
	iters: 500, epoch: 9 | loss: 0.3821295
	speed: 0.0718s/iter; left time: 45.7545s
Max Memory (MB): 178.2080078125
Epoch: 9 cost time: 43.65120816230774
Epoch: 9, Steps: 568 | Train Loss: 0.4677539 Vali Loss: 0.4629484 Test Loss: 0.2033238
EarlyStopping counter: 2 out of 3
Updating learning rate to 3.90625e-07
	iters: 100, epoch: 10 | loss: 0.3910383
	speed: 1.4142s/iter; left time: 663.2390s
	iters: 200, epoch: 10 | loss: 0.4542025
	speed: 0.0729s/iter; left time: 26.8939s
	iters: 300, epoch: 10 | loss: 0.3791907
	speed: 0.0724s/iter; left time: 19.4812s
	iters: 400, epoch: 10 | loss: 0.3834861
	speed: 0.0697s/iter; left time: 11.7729s
	iters: 500, epoch: 10 | loss: 0.3914808
	speed: 0.0750s/iter; left time: 5.1739s
Max Memory (MB): 178.2080078125
Epoch: 10 cost time: 42.36544966697693
Epoch: 10, Steps: 568 | Train Loss: 0.4674659 Vali Loss: 0.4623166 Test Loss: 0.2032948
Validation loss decreased (0.462376 --> 0.462317).  Saving model ...
Updating learning rate to 1.953125e-07
>>>>>>>testing : weather_336_192_iTransformer_custom_M_ft336_sl48_ll192_pl128_dm8_nh3_el1_dl128_df1_fctimeF_ebTrue_dtExp_projection_0<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
test 10348
test shape: (10348, 1, 192, 21) (10348, 1, 192, 21)
test shape: (10348, 192, 21) (10348, 192, 21)
mse:0.20329497754573822, mae:0.24941802024841309
